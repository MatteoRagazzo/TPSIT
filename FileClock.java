import java.util.Date;
import java.util.Random;
import java.util.concurrent.TimeUnit;

public class FileClock implements Runnable {
    
    Thread[] threads;
    int i;
    Random rand = new Random();
    Thread interrupt;
    
    public FileClock(Thread[] vector, int position) {
        threads = vector;
        i=position;
    }
       
    public void run() {
        while(true) {
            System.out.print(i+". "+ new Date()+"\n");
            try {
                TimeUnit.SECONDS.sleep(1);
                interrupt = threads[new Random().nextInt(threads.length)];
            } catch (InterruptedException e) {
                System.out.println("Thread n. "+i+" interrupted");
                removeThread();
                return;
            }
            interrompi();
        }
    }
	private void removeThread(){
		Thread[] v = new Thread[threads.length-1];
        for (int i = 0; i < v.length; i++) {
            if(threads[i]!= Thread.currentThread()){
                v[i] = threads[i];
            }
        }
        threads=v;	
	}
    
    private void interrompi() {
        if(lastOne()){
            Thread.currentThread().interrupt();
        }
        else{
            interrupt.interrupt();
        }
    }
    
    
    private boolean lastOne() {
        for (int i = 0; i < threads.length; i++) {
            if(threads[i].isAlive() && threads[i]!=Thread.currentThread()){
                return false;
            }
        }
        return true;
    }
    
    
    
}
